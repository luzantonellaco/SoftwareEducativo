{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Perfil del Estudiante</title>
    <!-- Cargamos los estilos externos -->
    <link rel="stylesheet" href="{% static 'aplicacion/style.css' %}">
</head>
<body>
    
    <!-- TTULO DE LA APLICACIN: FUERA de la tarjeta -->
    <h1 class="title">AVENTURA TCP/IP: CARRERA DE CAPAS </h1>
   
    <!-- Contenedor principal de la tarjeta de perfil -->
    <div class="profile-container">

        {% if user.is_authenticated %}
            
            <!-- CONTENEDOR DEL ALIAS Y ROL (MUESTRA INFORMACIN DEL PERFIL) -->
            <div class="profile-meta">
                <!-- Se accede al Alias (o Username por defecto) y al Rol -->
                Alias: <strong>{{ user.alias|default:user.username }}</strong> | Rol: {{ user.rol }}
            </div>

            <div class="profile-header">
                <h2>Perfil del Estudiante</h2>
                <h1>隆Bienvenido/a, {{ user.first_name }} {{ user.last_name }}!</h1> 
                <hr style="margin-top: 30px;">
            </div>

            <!-- Secci贸n de Niveles del Juego -->
            <h3 style="text-align: center; color: #0077B6; margin-bottom: 30px;">Elige la Capa para Iniciar la Carrera</h3>

            <div class="game-levels">
                
                <!-- NIVEL 1: CAPA DE APLICACIN (Desbloqueado) -->
                <div class="level-card unlocked">
                    <h3>Nivel 1</h3>
                    <p>Capa de Aplicaci贸n</p>
                    <a href="{% url 'juego_capa_1' %}" class="level-button">
                        INICIAR
                    </a>
                </div>

                <!-- NIVEL 2: CAPA DE TRANSPORTE -->
                <div id="level-2-card" class="level-card {% if unlocked_level_2 %}unlocked{% else %}locked{% endif %}">
                    {% if not unlocked_level_2 %}
                        <span class="locked-icon"></span>
                    {% endif %}
                    <h3>Nivel 2</h3>
                    <p>Capa de Transporte</p>
                    <a href="{% if unlocked_level_2 %}{% url 'juego_capa_2' %}{% else %}#{% endif %}" class="level-button" id="level-2-button">
                        {% if unlocked_level_2 %}INICIAR{% else %}BLOQUEADO{% endif %}
                    </a>
                </div>

                <!-- NIVEL 3: CAPA DE RED (Bloqueado) -->
                <div class="level-card locked">
                    <span class="locked-icon"></span>
                    <h3>Nivel 3</h3>
                    <p>Capa de Red</p>
                    <a href="#" class="level-button">
                        BLOQUEADO
                    </a>
                </div>
                
                <!-- NIVEL 4: CAPA DE ENLACE (Bloqueado) -->
                <div class="level-card locked">
                    <span class="locked-icon"></span>
                    <h3>Nivel 4</h3>
                    <p>Capa de Enlace</p>
                    <a href="#" class="level-button">
                        BLOQUEADO
                    </a>
                </div>

                <!-- NIVEL 5: CAPA FSICA (Bloqueado) -->
                <div class="level-card locked">
                    <span class="locked-icon"></span>
                    <h3>Nivel 5</h3>
                    <p>Capa F铆sica</p>
                    <a href="#" class="level-button">
                        BLOQUEADO
                    </a>
                </div>

                <!-- Nivel FINAL -->
                <div class="level-card locked">
                    <span class="locked-icon"></span>
                    <h3>FINAL</h3>
                    <p>Prueba Global</p>
                    <a href="#" class="level-button">
                        BLOQUEADO
                    </a>
                </div>
            </div>
            
        {% else %}
            <h1>Acceso Denegado</h1>
            <p>Necesitas iniciar sesi贸n para ver esta p谩gina.</p>
        {% endif %}
        
        <!-- Enlace de retorno/logout -->
        <p class="link-return" style="margin-top: 30px;">
            <a href="{% url 'index' %}">Volver a selecci贸n de perfil</a>
        </p>

    </div>
    
    <script>
        // Comprobar si Nivel 2 fue desbloqueado en localStorage por el juego
        (function(){
            try {
                const unlocked = localStorage.getItem('unlocked_level_2');
                if (unlocked === 'true') {
                    const card = document.getElementById('level-2-card');
                    const btn = document.getElementById('level-2-button');
                    if (card && btn) {
                        card.classList.remove('locked');
                        card.classList.add('unlocked');
                        // cambiar texto y enlace al iniciar nivel 2 (ajusta la URL si implementas la vista)
                        btn.textContent = 'INICIAR';
                        btn.href = '/juego/capa2/';
                    }
                }
            } catch(e) {
                // si localStorage est谩 bloqueado, no hacemos nada
                console.warn('No se pudo leer localStorage para desbloqueo de niveles.');
            }
        })();
    </script>

</body>